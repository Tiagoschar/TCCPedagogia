<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Listagem de Pacientes — Admin</title>

  <link rel="stylesheet" href="../main.css">
  <link rel="icon" type="image/x-icon" href="Assets/Logo.jpg">

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>

<body>
  <div class="admin-layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h2>Admin</h2>
      <nav>
        <a href="dashboard.html" class="nav-link">📊 Dashboard</a>
        <a href="pacientes.html" class="nav-link">👥 Pacientes</a>
        <a href="consultas.html" class="nav-link">🗓 Agenda</a>
        <a href="config.html" class="nav-link">⚙ Configurações</a>
      </nav>
    </aside>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="container">
      <h1>Pacientes</h1>
      <p class="muted">Gerencie sua lista de pacientes cadastrados.</p>

      <!-- Barra de ações -->
      <div class="mt-3">
        <a href="novo-paciente.html" class="btn btn-primary">➕ Novo Paciente</a>
        <input id="searchInput" type="search" class="input" placeholder="Buscar paciente..."
          style="max-width: 260px; margin-left:12px">
      </div>

      <!-- Tabela de pacientes -->
      <div class="table-responsive mt-3 panel">
        <table class="table" id="pacientesTable">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Idade</th>
              <th>Responsável</th>
              <th>Contato</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody id="pacientesBody">
            <tr>
              <td colspan="6" style="text-align: center;">Carregando...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Importando Firebase (modular SDK)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      onSnapshot,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 🔥 Configuração do Firebase (troque pelos dados do seu projeto)
    const firebaseConfig = {
    apiKey: "AIzaSyDvMSEl-3Tj5IvC5cs09DY8xZuUve4NyOU",
    authDomain: "tccneuropsicopedagoga.firebaseapp.com",
    projectId: "tccneuropsicopedagoga",
    storageBucket: "tccneuropsicopedagoga.firebasestorage.app",
    messagingSenderId: "189432898003",
    appId: "1:189432898003:web:aab9ddd5eba744a6350f26",
    measurementId: "G-XR0LJT1KB8"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const pacientesBody = document.getElementById("pacientesBody");
    const searchInput = document.getElementById("searchInput");

    // Função para renderizar pacientes
    function renderPacientes(pacientes) {
      pacientesBody.innerHTML = "";

      if (pacientes.length === 0) {
        pacientesBody.innerHTML = `<tr><td colspan="6" style="text-align:center;">Nenhum paciente encontrado</td></tr>`;
        return;
      }

      pacientes.forEach(doc => {
        const p = doc.data();
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${p.nome || "-"}</td>
          <td>${p.idade || "-"}</td>
          <td>${p.responsavel || "-"}</td>
          <td>${p.contato || "-"}</td>
          <td><span class="badge" style="background: ${p.status === "Ativo" ? "var(--primary)" : "var(--muted)"}">
              ${p.status || "Desconhecido"}
          </span></td>
          <td>
            <a href="editar-paciente.html?id=${doc.id}" class="btn btn-ghost">✏ Editar</a>
            <button data-id="${doc.id}" class="btn btn-ghost" style="color: var(--danger)">🗑 Excluir</button>
          </td>
        `;
        pacientesBody.appendChild(tr);
      });
    }

    // Carregar pacientes em tempo real
    const q = query(collection(db, "pacientes"), orderBy("nome", "asc"));
    onSnapshot(q, snapshot => {
      const pacientes = snapshot.docs;
      renderPacientes(pacientes);
    });

    // 🔍 Filtro de busca
    searchInput.addEventListener("input", async (e) => {
      const search = e.target.value.toLowerCase();

      const q = query(collection(db, "pacientes"), orderBy("nome", "asc"));
      const querySnapshot = await getDocs(q);

      const filtrados = querySnapshot.docs.filter(doc =>
        doc.data().nome.toLowerCase().includes(search)
      );

      renderPacientes(filtrados);
    });
  </script>
</body>

</html>
